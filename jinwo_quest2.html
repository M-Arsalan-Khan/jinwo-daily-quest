<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THE SYSTEM — Shadow Monarch Edition</title>

<!-- Fonts for sci-fi HUD feel -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
/* =====================================================
   DESIGN TOKENS (single source of truth for colors)
===================================================== */
:root {
  --system-blue: #00f2ff;
  --system-bg: rgba(5, 12, 20, 0.95);
  --penalty-red: #ff0033;
  --level-purple: #bc13fe;
  --shadow-black: #050505;
}

/* =====================================================
   GLOBAL RESET
===================================================== */
* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  height: 100%;
  background: var(--shadow-black);
  color: white;
  font-family: 'Rajdhani', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

/* =====================================================
   MAIN SYSTEM WINDOW (HUD)
===================================================== */
.system-window {
  width: 460px;
  padding: 30px;
  background: var(--system-bg);
  border: 2px solid var(--system-blue);
  box-shadow: 0 0 30px rgba(0,242,255,0.25);
  position: relative;
  z-index: 5;

  /* Sharp sci-fi edges */
  clip-path: polygon(
    0 6%, 6% 0, 94% 0, 100% 6%,
    100% 94%, 94% 100%, 6% 100%, 0 94%
  );
}

h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 1.3rem;
  margin-top: 0;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--system-blue);
  color: var(--system-blue);
  text-shadow: 0 0 10px var(--system-blue);
}

/* =====================================================
   LEVEL + XP DISPLAY
===================================================== */
#player-level {
  margin-top: 12px;
  font-size: 0.9rem;
  letter-spacing: 2px;
  color: var(--system-blue);
}

/* =====================================================
   PROGRESS BAR
===================================================== */
.bar-bg {
  width: 100%;
  height: 10px;
  margin: 18px 0;
  border: 1px solid var(--system-blue);
  background: rgba(0,242,255,0.1);
}

#bar-fill {
  height: 100%;
  width: 0%;
  background: var(--system-blue);
  box-shadow: 0 0 15px var(--system-blue);
  transition: width 0.6s ease;
}

/* =====================================================
   QUEST LIST
===================================================== */
ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

li {
  background: rgba(255,255,255,0.03);
  margin-bottom: 10px;
  padding: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-left: 3px solid transparent;
  cursor: pointer;
  transition: 0.25s;
}

li:hover {
  background: rgba(0,242,255,0.08);
  border-left-color: var(--system-blue);
}

/* Completed / locked quest */
li.completed {
  opacity: 0.35;
  text-decoration: line-through;
  border-left-color: #444;
  pointer-events: none;
}

/* =====================================================
   OVERLAYS (MODALS)
===================================================== */
.overlay {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  backdrop-filter: blur(12px);
  background: rgba(0,0,0,0.85);
  z-index: 1000;
  text-align: center;
}

/* =====================================================
   BUTTONS
===================================================== */
button {
  background: rgba(0,0,0,0.7);
  color: var(--system-blue);
  border: 2px solid var(--system-blue);
  padding: 12px 45px;
  font-family: 'Orbitron', sans-serif;
  font-size: 1.05rem;
  letter-spacing: 3px;
  cursor: pointer;
  clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
  box-shadow: 0 0 15px rgba(0,242,255,0.3);
  transition: 0.3s;
}

button:hover {
  background: var(--system-blue);
  color: black;
  box-shadow: 0 0 35px var(--system-blue);
  transform: scale(1.05);
}

/* =====================================================
   TEXT EFFECTS & ANIMATIONS
===================================================== */
.huge-text {
  font-family: 'Orbitron';
  font-size: 3.5rem;
  letter-spacing: 5px;
}

.shake-anim {
  animation: shake 0.2s infinite;
}

@keyframes shake {
  0%,100% { transform: translate(0,0); }
  25% { transform: translate(4px,4px); }
  75% { transform: translate(-4px,-4px); }
}

/* Canvas for shadow particles */
#shadow-canvas {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
</style>
</head>

<body>

<!-- =====================================================
     MAIN UI
===================================================== -->
<div class="system-window">
  <h1>[ DAILY QUEST : BECOME THE MONARCH ]</h1>

  <p id="player-level">
    LEVEL <span id="level-num">1</span> • XP <span id="xp-num">0</span>
  </p>

  <div class="bar-bg">
    <div id="bar-fill"></div>
  </div>

  <ul id="quest-list"></ul>

  <p style="color:#ff4d4d;font-size:0.7rem;text-align:center;letter-spacing:1px;margin-top:15px;">
    ⚠ SYSTEM IS MONITORING YOUR ACTIVITY
  </p>

  <p style="font-size:0.7rem;text-align:center;color:#9aa4b2;">
    Daily quests reset at midnight
  </p>
</div>

<!-- =====================================================
     LEVEL UP MODAL
===================================================== -->
<div id="level-up-modal" class="overlay">
  <canvas id="shadow-canvas"></canvas>
  <div style="z-index:1001;">
    <h2 id="status-heading" class="huge-text" style="color:var(--level-purple);">
      QUEST CLEARED
    </h2>
    <p id="extraction-msg" style="font-size:1.2rem;margin:20px 0;">
      THE SHADOWS AWAIT YOUR COMMAND
    </p>
    <button onclick="startExtraction()">ARISE</button>
  </div>
</div>

<!-- =====================================================
     PENALTY MODAL
===================================================== -->
<div id="penalty-modal" class="overlay">
  <h2 class="huge-text shake-anim" style="color:var(--penalty-red);">
    PENALTY TRIGGERED
  </h2>
  <p style="font-size:1.2rem;margin:20px 0;">
    INACTIVITY DETECTED — QUEST FAILED
  </p>
  <button onclick="location.reload()">RE-ENTER SYSTEM</button>
</div>

<script>
/* =====================================================
   UTILITIES
===================================================== */

// Always use readable date (prevents timezone bugs)
function today() {
  return new Date().toDateString();
}

/* =====================================================
   QUEST DATA
===================================================== */
const quests = [
  { id: 1, text: "Push-ups: 100/100", xp: 100 },
  { id: 2, text: "Code: 2 Hours", xp: 300 },
  { id: 3, text: "Run: 10 KM", xp: 200 }
];

/* =====================================================
   PLAYER STATE (persistent)
===================================================== */
let totalXP = Number(localStorage.getItem("totalXP")) || 0;
let level = Number(localStorage.getItem("level")) || 1;

// Stores { questId: "Mon Sep 09 2026" }
let questState = JSON.parse(localStorage.getItem("dailyQuests")) || {};

// Penalty if user does nothing
let penaltyTimer = setTimeout(triggerPenalty, 20000);

/* =====================================================
   INIT SYSTEM
===================================================== */
function init() {
  const list = document.getElementById("quest-list");
  list.innerHTML = "";

  quests.forEach(q => {
    const completedToday = questState[q.id] === today();

    const li = document.createElement("li");
    li.id = `q-${q.id}`;
    li.innerHTML = `
      <span>${q.text}</span>
      <span style="color:var(--system-blue)">+${q.xp} XP</span>
    `;

    // Lock quest if already done today
    if (completedToday) {
      li.classList.add("completed");
    } else {
      li.onclick = () => completeQuest(q.id);
    }

    list.appendChild(li);
  });

  updateUI();
}

/* =====================================================
   COMPLETE QUEST (ONCE PER DAY)
===================================================== */
function completeQuest(id) {
  clearTimeout(penaltyTimer);

  const quest = quests.find(q => q.id === id);

  // Mark quest as completed today
  questState[id] = today();
  localStorage.setItem("dailyQuests", JSON.stringify(questState));

  // XP & Level logic
  totalXP += quest.xp;
  const xpNeeded = level * 500;

  if (totalXP >= xpNeeded) {
    totalXP -= xpNeeded;
    level++;
  }

  localStorage.setItem("totalXP", totalXP);
  localStorage.setItem("level", level);

  init();

  // Check if ALL quests done today
  const allDone = quests.every(q => questState[q.id] === today());
  if (allDone) {
    setTimeout(triggerLevelUp, 600);
  }
}

/* =====================================================
   UI UPDATE
===================================================== */
function updateUI() {
  document.getElementById("level-num").innerText = level;
  document.getElementById("xp-num").innerText = totalXP;

  const completedCount = quests.filter(q => questState[q.id] === today()).length;
  const percent = Math.round((completedCount / quests.length) * 100);
  document.getElementById("bar-fill").style.width = percent + "%";
}

/* =====================================================
   MODALS
===================================================== */
function triggerLevelUp() {
  document.getElementById("level-up-modal").style.display = "flex";
}

function triggerPenalty() {
  const anyDone = quests.some(q => questState[q.id] === today());
  if (!anyDone) {
    document.getElementById("penalty-modal").style.display = "flex";
  }
}

/* =====================================================
   SHADOW EXTRACTION (CANVAS FX)
===================================================== */
function startExtraction() {
  const canvas = document.getElementById("shadow-canvas");
  const ctx = canvas.getContext("2d");

  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let particles = [];

  class Shadow {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = canvas.height + 40;
      this.size = Math.random() * 4 + 2;
      this.speed = Math.random() * 3 + 1;
      this.opacity = 1;
    }
    update() {
      this.y -= this.speed;
      this.x += Math.sin(this.y * 0.04) * 2;
      this.opacity -= 0.006;
    }
    draw() {
      ctx.fillStyle = `rgba(0,242,255,${this.opacity})`;
      ctx.shadowBlur = 15;
      ctx.shadowColor = "#00f2ff";
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function animate() {
    ctx.fillStyle = "rgba(0,0,0,0.2)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    if (particles.length < 120) particles.push(new Shadow());

    particles.forEach((p,i) => {
      p.update();
      p.draw();
      if (p.opacity <= 0) particles.splice(i,1);
    });

    requestAnimationFrame(animate);
  }

  animate();

  // Reset system after animation
  setTimeout(() => location.reload(), 5000);
}

/* =====================================================
   START SYSTEM
===================================================== */
init();
</script>

</body>
</html>
